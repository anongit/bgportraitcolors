// the ini functions, extracted from SFO and SFO_lite

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///// Read an ini file "ini_to_read.ini" into SFO_reserved_ini_hash (mostly borrowed from Kjeron)
/////
///// ini key values are treated case-insensitive
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

DEFINE_ACTION_FUNCTION SFO_read_ini_file
  STR_VAR ini_to_read=""
  RET_ARRAY SFO_reserved_ini_hash
BEGIN
  ACTION_IF "%ini_to_read%" STRING_EQUAL "" BEGIN
    OUTER_SPRINT ini_to_read "%MOD_FOLDER%/%MOD_FOLDER%.ini"
  END
  OUTER_SPRINT key ""
  ACTION_IF FILE_EXISTS "%ini_to_read%" BEGIN
    COPY - "%ini_to_read%" "%workspace%"
    REPLACE_EVALUATE ~^\([^ %TAB%%WNL%]+\) *= *\([^%WNL%%TAB% $]+\)~
    BEGIN
      // key must start line and cannot contain whitespace
      // value is everything after the "=" until the newline/end
      SPRINT key "%MATCH1%"
      TO_LOWER key
      TEXT_SPRINT $SFO_reserved_ini_hash(~%key%~) ~%MATCH2%~
    END
    ~~
  END
END